# Rerport: LAB8

计13，张宏辉，2011011237
 
## 练习0：填写已有实验
 - 已完成

## 练习1: 完成读文件操作的实现（需要编码）

 - 首先了解打开文件的处理流程，然后参考本实验后续的文件读写操作的过程分析，编写在sfs_inode.c中sfs_io_nolock读文件中数据的实现代码。
   - 在sfs_inode.c代码中按照注释要求进行，调用sfs_bmap_load_nolock、sfs_buf_op和sfs_block_op函数对不同的类型的文件看进行读入即可。

 - 设计实现”UNIX的PIPE机制“的概要设方案
  - proc_struct中增加字段，记录当前进程是否为pipeline，并且记录该进程所要接收和发送的管道链接的内存地址。
  - 运行管道程序时，为所有管道链接建立一个长度大小固定的内存缓冲区。为所有程序创建一个新的进程，并设置其对应的数据接收和数据发送的管道链接缓冲区地址。
  - 在读写的系统调用中增加判断，如果当前进程在管道程序中，那么所有stdin和stdout的读写都会被重新定向到该进程proc_struct对应的内存缓冲区。对每一个缓冲区采取producer/consumer的设计模式，只有当缓冲区为空的时候，管道的前一个进程才能往缓冲区写数据，只有当缓冲区不为满的时候，管道的后一个进行才能往缓冲区读数据。
 
## 练习2: 完成基于文件系统的执行程序机制的实现（需要编码）

 - 简要说明你的设计实现过程
  - 在proc.c的代码中按照注释要求实现。这里的实现内容比较多，分步骤按照注释要求逐一实现，主要通过读取文件的方式来加载ELF格式的可执行程序。

 - 设计实现基于”UNIX的硬链接和软链接机制“的概要设方案
  - 在vfs和fs中新增一类数据结构，用来表示symbolic/hard link，在fs的inode中增加一个计数域，用来统计有多少硬链接指向当前inode.
  - 在新建软连接的时候，将vfs中的symbolic link在fs中创建对应的节点symbolic inode，然后fs中的symbolic link指向对应的inode。当inode被删除时，symbolic link不纳入计数的考虑范围。
  - 在新建硬链接时将vfs中的硬链接指向fs中的inode. 对于一个硬链接，会存在多个硬链接指向同一个inode的情况。因此当执行删除操作时，操作系统应该判断当前inode被多少硬链接引用，只有当引用数为零时才删除该inode。


感谢助教和老师这一学期以来的指导！