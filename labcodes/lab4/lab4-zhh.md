# Rerport: LAB4

计13，张宏辉，2011011237
 
## 练习0：填写已有实验
 - 已完成

## 练习1：分配并初始化一个进程控制块（需要编码）

 - 简要说明你的设计实现过程
   - 将state设置为PROC_UNINIT(标明为未初始化的进程)，pid设置为-1(标明不存在该进程)，cr3设置为boot_cr3(初始化为内核的页表起始地址)，其他均置为0即可。
 - 请说明proc_struct中struct context context和struct trapframe *tf成员变量含义和在本实验中的作用是啥？（提示通过看代码和编程调试可以判断出来）
   - context用于保存进程的上下文，包括eip，esp，ebx，ecx，edx，esi，edi，ebp八个寄存器的内容。
   - tf用于保存中断的进程数据，包括各个段寄存器的值、中断错误代号等。
 
## 练习2：为新创建的内核线程分配资源（需要编码）

 - 简要说明你的设计实现过程
   - 按照注释流程实现即可。
 - 请说明ucore是否做到给每个新fork的线程一个唯一的id？请说明你的分析和理由。
   - 可以，因为proc.c中的get_pid函数为每一个新fork的进程分配了一个唯一的id。

## 练习3：阅读代码，理解 proc_run 函数和它调用的函数如何完成进程切换的。（无编码工作）

 - 简要说明你对proc_run函数的分析
   - proc_run函数实现进程之间的切换。对于进程切换，利用load_esp0函数载入tss中特权态0下的栈顶指针esp0，并用lcr3指令切换页表，switch_to切换上下文即可。
 - 在本实验的执行过程中，创建且运行了几个内核线程？
   - 2个，分别是idle_proc和init_proc。
 - 语句local_intr_save(intr_flag);....local_intr_restore(intr_flag);在这里有何作用?请说明理由
   - 保证了括起来部分的代码中是不允许任何中断进入的，以保证在切换进程的时候屏蔽了中断，保证操作的原子性。

 